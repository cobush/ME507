\hypertarget{class_quaternion_filter}{}\doxysection{Quaternion\+Filter Class Reference}
\label{class_quaternion_filter}\index{QuaternionFilter@{QuaternionFilter}}


{\ttfamily \#include $<$Quaternion\+Filter.\+h$>$}

\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{class_quaternion_filter_a0451493e9052ab9aba4a8f31d87b0cfe}{bind}} ()
\item 
void \mbox{\hyperlink{class_quaternion_filter_a5792ddc520c93efa4761b8b1e39c785c}{update}} (float ax, float ay, float az, float gx, float gy, float gz, float mx, float my, float mz, float $\ast$q)
\item 
void \mbox{\hyperlink{class_quaternion_filter_acccd0d561278e57f48a5b26ac7e54735}{Mahony\+Quaternion\+Update}} (float ax, float ay, float az, float gx, float gy, float gz, float mx, float my, float mz, float $\ast$q)
\end{DoxyCompactItemize}
\doxysubsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
float \mbox{\hyperlink{class_quaternion_filter_a3a8ca78e23c86ceeae34482bdb13aa7d}{Gyro\+Meas\+Error}} = PI $\ast$ (40.\+0f / 180.\+0f)
\item 
float \mbox{\hyperlink{class_quaternion_filter_ab30d4bce3891d2c5fc338b3252560c0f}{Gyro\+Meas\+Drift}} = PI $\ast$ (0.\+0f / 180.\+0f)
\item 
float \mbox{\hyperlink{class_quaternion_filter_abd5ceeec025272a84597125052265710}{beta}} = sqrt(3.\+0f / 4.\+0f) $\ast$ \mbox{\hyperlink{class_quaternion_filter_a3a8ca78e23c86ceeae34482bdb13aa7d}{Gyro\+Meas\+Error}}
\item 
float \mbox{\hyperlink{class_quaternion_filter_a61c16cff27a1b1dad8b5ed185f040a8a}{zeta}} = sqrt(3.\+0f / 4.\+0f) $\ast$ \mbox{\hyperlink{class_quaternion_filter_ab30d4bce3891d2c5fc338b3252560c0f}{Gyro\+Meas\+Drift}}
\item 
const float \mbox{\hyperlink{class_quaternion_filter_afe6f117c82a21e9ddde4c9c9b9dbbc15}{Kp}} = 2.\+0f $\ast$ 5.\+0f
\item 
const float \mbox{\hyperlink{class_quaternion_filter_a7d15579f2818aa39a3b98e84ac4eaf3e}{Ki}} = 0.\+0f
\item 
float \mbox{\hyperlink{class_quaternion_filter_a0d455d04c45199160db280a5adf45a9a}{deltat}} = 0.\+0f
\item 
float \mbox{\hyperlink{class_quaternion_filter_a0e194aa9d6527928626fab538aecc20e}{sum}} = 0.\+0f
\item 
uint32\+\_\+t \mbox{\hyperlink{class_quaternion_filter_a62ca83c2a4d4b15262600b47332ba2bf}{last\+Update}} = 0
\item 
uint32\+\_\+t \mbox{\hyperlink{class_quaternion_filter_a5b637ebad8bb92ef780af205ae77283c}{first\+Update}} = 0
\item 
uint32\+\_\+t \mbox{\hyperlink{class_quaternion_filter_a4aecefd720d2303c9415bdbffeb79f4f}{Now}} = 0
\item 
float \mbox{\hyperlink{class_quaternion_filter_afa8fc4d4be86803a96d7c0dc54b9e0cf}{e\+Int}} \mbox{[}3\mbox{]} = \{0.\+0f, 0.\+0f, 0.\+0f\}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


Definition at line 5 of file Quaternion\+Filter.\+h.



\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_quaternion_filter_a0451493e9052ab9aba4a8f31d87b0cfe}\label{class_quaternion_filter_a0451493e9052ab9aba4a8f31d87b0cfe}} 
\index{QuaternionFilter@{QuaternionFilter}!bind@{bind}}
\index{bind@{bind}!QuaternionFilter@{QuaternionFilter}}
\doxysubsubsection{\texorpdfstring{bind()}{bind()}}
{\footnotesize\ttfamily void Quaternion\+Filter\+::bind (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line 24 of file Quaternion\+Filter.\+h.


\begin{DoxyCode}{0}
\DoxyCodeLine{24 \{\}}

\end{DoxyCode}
\mbox{\Hypertarget{class_quaternion_filter_acccd0d561278e57f48a5b26ac7e54735}\label{class_quaternion_filter_acccd0d561278e57f48a5b26ac7e54735}} 
\index{QuaternionFilter@{QuaternionFilter}!MahonyQuaternionUpdate@{MahonyQuaternionUpdate}}
\index{MahonyQuaternionUpdate@{MahonyQuaternionUpdate}!QuaternionFilter@{QuaternionFilter}}
\doxysubsubsection{\texorpdfstring{MahonyQuaternionUpdate()}{MahonyQuaternionUpdate()}}
{\footnotesize\ttfamily void Quaternion\+Filter\+::\+Mahony\+Quaternion\+Update (\begin{DoxyParamCaption}\item[{float}]{ax,  }\item[{float}]{ay,  }\item[{float}]{az,  }\item[{float}]{gx,  }\item[{float}]{gy,  }\item[{float}]{gz,  }\item[{float}]{mx,  }\item[{float}]{my,  }\item[{float}]{mz,  }\item[{float $\ast$}]{q }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line 129 of file Quaternion\+Filter.\+h.


\begin{DoxyCode}{0}
\DoxyCodeLine{130     \{}
\DoxyCodeLine{131         \textcolor{keywordtype}{float} q1 = q[0], q2 = q[1], q3 = q[2], q4 = q[3];   \textcolor{comment}{// short name local variable for readability}}
\DoxyCodeLine{132         \textcolor{keywordtype}{float} norm;}
\DoxyCodeLine{133         \textcolor{keywordtype}{float} hx, hy, bx, bz;}
\DoxyCodeLine{134         \textcolor{keywordtype}{float} vx, vy, vz, wx, wy, wz;}
\DoxyCodeLine{135         \textcolor{keywordtype}{float} ex, ey, ez;}
\DoxyCodeLine{136         \textcolor{keywordtype}{float} pa, pb, pc;}
\DoxyCodeLine{137 }
\DoxyCodeLine{138         \textcolor{comment}{// Auxiliary variables to avoid repeated arithmetic}}
\DoxyCodeLine{139         \textcolor{keywordtype}{float} q1q1 = q1 * q1;}
\DoxyCodeLine{140         \textcolor{keywordtype}{float} q1q2 = q1 * q2;}
\DoxyCodeLine{141         \textcolor{keywordtype}{float} q1q3 = q1 * q3;}
\DoxyCodeLine{142         \textcolor{keywordtype}{float} q1q4 = q1 * q4;}
\DoxyCodeLine{143         \textcolor{keywordtype}{float} q2q2 = q2 * q2;}
\DoxyCodeLine{144         \textcolor{keywordtype}{float} q2q3 = q2 * q3;}
\DoxyCodeLine{145         \textcolor{keywordtype}{float} q2q4 = q2 * q4;}
\DoxyCodeLine{146         \textcolor{keywordtype}{float} q3q3 = q3 * q3;}
\DoxyCodeLine{147         \textcolor{keywordtype}{float} q3q4 = q3 * q4;}
\DoxyCodeLine{148         \textcolor{keywordtype}{float} q4q4 = q4 * q4;}
\DoxyCodeLine{149 }
\DoxyCodeLine{150         \textcolor{comment}{// Normalise accelerometer measurement}}
\DoxyCodeLine{151         norm = sqrtf(ax * ax + ay * ay + az * az);}
\DoxyCodeLine{152         \textcolor{keywordflow}{if} (norm == 0.0f) \textcolor{keywordflow}{return}; \textcolor{comment}{// handle NaN}}
\DoxyCodeLine{153         norm = 1.0f / norm;        \textcolor{comment}{// use reciprocal for division}}
\DoxyCodeLine{154         ax *= norm;}
\DoxyCodeLine{155         ay *= norm;}
\DoxyCodeLine{156         az *= norm;}
\DoxyCodeLine{157 }
\DoxyCodeLine{158         \textcolor{comment}{// Normalise magnetometer measurement}}
\DoxyCodeLine{159         norm = sqrtf(mx * mx + my * my + mz * mz);}
\DoxyCodeLine{160         \textcolor{keywordflow}{if} (norm == 0.0f) \textcolor{keywordflow}{return}; \textcolor{comment}{// handle NaN}}
\DoxyCodeLine{161         norm = 1.0f / norm;        \textcolor{comment}{// use reciprocal for division}}
\DoxyCodeLine{162         mx *= norm;}
\DoxyCodeLine{163         my *= norm;}
\DoxyCodeLine{164         mz *= norm;}
\DoxyCodeLine{165 }
\DoxyCodeLine{166         \textcolor{comment}{// Reference direction of Earth's magnetic field}}
\DoxyCodeLine{167         hx = 2.0f * mx * (0.5f -\/ q3q3 -\/ q4q4) + 2.0f * my * (q2q3 -\/ q1q4) + 2.0f * mz * (q2q4 + q1q3);}
\DoxyCodeLine{168         hy = 2.0f * mx * (q2q3 + q1q4) + 2.0f * my * (0.5f -\/ q2q2 -\/ q4q4) + 2.0f * mz * (q3q4 -\/ q1q2);}
\DoxyCodeLine{169         bx = sqrtf((hx * hx) + (hy * hy));}
\DoxyCodeLine{170         bz = 2.0f * mx * (q2q4 -\/ q1q3) + 2.0f * my * (q3q4 + q1q2) + 2.0f * mz * (0.5f -\/ q2q2 -\/ q3q3);}
\DoxyCodeLine{171 }
\DoxyCodeLine{172         \textcolor{comment}{// Estimated direction of gravity and magnetic field}}
\DoxyCodeLine{173         vx = 2.0f * (q2q4 -\/ q1q3);}
\DoxyCodeLine{174         vy = 2.0f * (q1q2 + q3q4);}
\DoxyCodeLine{175         vz = q1q1 -\/ q2q2 -\/ q3q3 + q4q4;}
\DoxyCodeLine{176         wx = 2.0f * bx * (0.5f -\/ q3q3 -\/ q4q4) + 2.0f * bz * (q2q4 -\/ q1q3);}
\DoxyCodeLine{177         wy = 2.0f * bx * (q2q3 -\/ q1q4) + 2.0f * bz * (q1q2 + q3q4);}
\DoxyCodeLine{178         wz = 2.0f * bx * (q1q3 + q2q4) + 2.0f * bz * (0.5f -\/ q2q2 -\/ q3q3);}
\DoxyCodeLine{179 }
\DoxyCodeLine{180         \textcolor{comment}{// Error is cross product between estimated direction and measured direction of gravity}}
\DoxyCodeLine{181         ex = (ay * vz -\/ az * vy) + (my * wz -\/ mz * wy);}
\DoxyCodeLine{182         ey = (az * vx -\/ ax * vz) + (mz * wx -\/ mx * wz);}
\DoxyCodeLine{183         ez = (ax * vy -\/ ay * vx) + (mx * wy -\/ my * wx);}
\DoxyCodeLine{184         \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_quaternion_filter_a7d15579f2818aa39a3b98e84ac4eaf3e}{Ki}} > 0.0f)}
\DoxyCodeLine{185         \{}
\DoxyCodeLine{186             \mbox{\hyperlink{class_quaternion_filter_afa8fc4d4be86803a96d7c0dc54b9e0cf}{eInt}}[0] += ex;      \textcolor{comment}{// accumulate integral error}}
\DoxyCodeLine{187             \mbox{\hyperlink{class_quaternion_filter_afa8fc4d4be86803a96d7c0dc54b9e0cf}{eInt}}[1] += ey;}
\DoxyCodeLine{188             \mbox{\hyperlink{class_quaternion_filter_afa8fc4d4be86803a96d7c0dc54b9e0cf}{eInt}}[2] += ez;}
\DoxyCodeLine{189         \}}
\DoxyCodeLine{190         \textcolor{keywordflow}{else}}
\DoxyCodeLine{191         \{}
\DoxyCodeLine{192             \mbox{\hyperlink{class_quaternion_filter_afa8fc4d4be86803a96d7c0dc54b9e0cf}{eInt}}[0] = 0.0f;     \textcolor{comment}{// prevent integral wind up}}
\DoxyCodeLine{193             \mbox{\hyperlink{class_quaternion_filter_afa8fc4d4be86803a96d7c0dc54b9e0cf}{eInt}}[1] = 0.0f;}
\DoxyCodeLine{194             \mbox{\hyperlink{class_quaternion_filter_afa8fc4d4be86803a96d7c0dc54b9e0cf}{eInt}}[2] = 0.0f;}
\DoxyCodeLine{195         \}}
\DoxyCodeLine{196 }
\DoxyCodeLine{197         \textcolor{comment}{// Apply feedback terms}}
\DoxyCodeLine{198         gx = gx + \mbox{\hyperlink{class_quaternion_filter_afe6f117c82a21e9ddde4c9c9b9dbbc15}{Kp}} * ex + \mbox{\hyperlink{class_quaternion_filter_a7d15579f2818aa39a3b98e84ac4eaf3e}{Ki}} * \mbox{\hyperlink{class_quaternion_filter_afa8fc4d4be86803a96d7c0dc54b9e0cf}{eInt}}[0];}
\DoxyCodeLine{199         gy = gy + \mbox{\hyperlink{class_quaternion_filter_afe6f117c82a21e9ddde4c9c9b9dbbc15}{Kp}} * ey + \mbox{\hyperlink{class_quaternion_filter_a7d15579f2818aa39a3b98e84ac4eaf3e}{Ki}} * \mbox{\hyperlink{class_quaternion_filter_afa8fc4d4be86803a96d7c0dc54b9e0cf}{eInt}}[1];}
\DoxyCodeLine{200         gz = gz + \mbox{\hyperlink{class_quaternion_filter_afe6f117c82a21e9ddde4c9c9b9dbbc15}{Kp}} * ez + \mbox{\hyperlink{class_quaternion_filter_a7d15579f2818aa39a3b98e84ac4eaf3e}{Ki}} * \mbox{\hyperlink{class_quaternion_filter_afa8fc4d4be86803a96d7c0dc54b9e0cf}{eInt}}[2];}
\DoxyCodeLine{201 }
\DoxyCodeLine{202         \textcolor{comment}{// Integrate rate of change of quaternion}}
\DoxyCodeLine{203         pa = q2;}
\DoxyCodeLine{204         pb = q3;}
\DoxyCodeLine{205         pc = q4;}
\DoxyCodeLine{206         q1 = q1 + (-\/q2 * gx -\/ q3 * gy -\/ q4 * gz) * (0.5f * \mbox{\hyperlink{class_quaternion_filter_a0d455d04c45199160db280a5adf45a9a}{deltat}});}
\DoxyCodeLine{207         q2 = pa + (q1 * gx + pb * gz -\/ pc * gy) * (0.5f * \mbox{\hyperlink{class_quaternion_filter_a0d455d04c45199160db280a5adf45a9a}{deltat}});}
\DoxyCodeLine{208         q3 = pb + (q1 * gy -\/ pa * gz + pc * gx) * (0.5f * \mbox{\hyperlink{class_quaternion_filter_a0d455d04c45199160db280a5adf45a9a}{deltat}});}
\DoxyCodeLine{209         q4 = pc + (q1 * gz + pa * gy -\/ pb * gx) * (0.5f * \mbox{\hyperlink{class_quaternion_filter_a0d455d04c45199160db280a5adf45a9a}{deltat}});}
\DoxyCodeLine{210 }
\DoxyCodeLine{211         \textcolor{comment}{// Normalise quaternion}}
\DoxyCodeLine{212         norm = sqrtf(q1 * q1 + q2 * q2 + q3 * q3 + q4 * q4);}
\DoxyCodeLine{213         norm = 1.0f / norm;}
\DoxyCodeLine{214         q[0] = q1 * norm;}
\DoxyCodeLine{215         q[1] = q2 * norm;}
\DoxyCodeLine{216         q[2] = q3 * norm;}
\DoxyCodeLine{217         q[3] = q4 * norm;}
\DoxyCodeLine{218     \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_quaternion_filter_a5792ddc520c93efa4761b8b1e39c785c}\label{class_quaternion_filter_a5792ddc520c93efa4761b8b1e39c785c}} 
\index{QuaternionFilter@{QuaternionFilter}!update@{update}}
\index{update@{update}!QuaternionFilter@{QuaternionFilter}}
\doxysubsubsection{\texorpdfstring{update()}{update()}}
{\footnotesize\ttfamily void Quaternion\+Filter\+::update (\begin{DoxyParamCaption}\item[{float}]{ax,  }\item[{float}]{ay,  }\item[{float}]{az,  }\item[{float}]{gx,  }\item[{float}]{gy,  }\item[{float}]{gz,  }\item[{float}]{mx,  }\item[{float}]{my,  }\item[{float}]{mz,  }\item[{float $\ast$}]{q }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line 27 of file Quaternion\+Filter.\+h.


\begin{DoxyCode}{0}
\DoxyCodeLine{28     \{}
\DoxyCodeLine{29         \textcolor{comment}{// updateParams()}}
\DoxyCodeLine{30         \textcolor{keywordtype}{float} q1 = q[0], q2 = q[1], q3 = q[2], q4 = q[3];   \textcolor{comment}{// short name local variable for readability}}
\DoxyCodeLine{31         \textcolor{keywordtype}{float} norm;}
\DoxyCodeLine{32         \textcolor{keywordtype}{float} hx, hy, \_2bx, \_2bz;}
\DoxyCodeLine{33         \textcolor{keywordtype}{float} s1, s2, s3, s4;}
\DoxyCodeLine{34         \textcolor{keywordtype}{float} qDot1, qDot2, qDot3, qDot4;}
\DoxyCodeLine{35 }
\DoxyCodeLine{36         \textcolor{comment}{// Auxiliary variables to avoid repeated arithmetic}}
\DoxyCodeLine{37         \textcolor{keywordtype}{float} \_2q1mx;}
\DoxyCodeLine{38         \textcolor{keywordtype}{float} \_2q1my;}
\DoxyCodeLine{39         \textcolor{keywordtype}{float} \_2q1mz;}
\DoxyCodeLine{40         \textcolor{keywordtype}{float} \_2q2mx;}
\DoxyCodeLine{41         \textcolor{keywordtype}{float} \_4bx;}
\DoxyCodeLine{42         \textcolor{keywordtype}{float} \_4bz;}
\DoxyCodeLine{43         \textcolor{keywordtype}{float} \_2q1 = 2.0f * q1;}
\DoxyCodeLine{44         \textcolor{keywordtype}{float} \_2q2 = 2.0f * q2;}
\DoxyCodeLine{45         \textcolor{keywordtype}{float} \_2q3 = 2.0f * q3;}
\DoxyCodeLine{46         \textcolor{keywordtype}{float} \_2q4 = 2.0f * q4;}
\DoxyCodeLine{47         \textcolor{keywordtype}{float} \_2q1q3 = 2.0f * q1 * q3;}
\DoxyCodeLine{48         \textcolor{keywordtype}{float} \_2q3q4 = 2.0f * q3 * q4;}
\DoxyCodeLine{49         \textcolor{keywordtype}{float} q1q1 = q1 * q1;}
\DoxyCodeLine{50         \textcolor{keywordtype}{float} q1q2 = q1 * q2;}
\DoxyCodeLine{51         \textcolor{keywordtype}{float} q1q3 = q1 * q3;}
\DoxyCodeLine{52         \textcolor{keywordtype}{float} q1q4 = q1 * q4;}
\DoxyCodeLine{53         \textcolor{keywordtype}{float} q2q2 = q2 * q2;}
\DoxyCodeLine{54         \textcolor{keywordtype}{float} q2q3 = q2 * q3;}
\DoxyCodeLine{55         \textcolor{keywordtype}{float} q2q4 = q2 * q4;}
\DoxyCodeLine{56         \textcolor{keywordtype}{float} q3q3 = q3 * q3;}
\DoxyCodeLine{57         \textcolor{keywordtype}{float} q3q4 = q3 * q4;}
\DoxyCodeLine{58         \textcolor{keywordtype}{float} q4q4 = q4 * q4;}
\DoxyCodeLine{59         gx *= PI / 180.f;}
\DoxyCodeLine{60         gy *= PI / 180.f;}
\DoxyCodeLine{61         gz *= PI / 180.f;}
\DoxyCodeLine{62 }
\DoxyCodeLine{63         \textcolor{comment}{// updateTime()}}
\DoxyCodeLine{64         \mbox{\hyperlink{class_quaternion_filter_a4aecefd720d2303c9415bdbffeb79f4f}{Now}} = micros();}
\DoxyCodeLine{65         \mbox{\hyperlink{class_quaternion_filter_a0d455d04c45199160db280a5adf45a9a}{deltat}} = ((\mbox{\hyperlink{class_quaternion_filter_a4aecefd720d2303c9415bdbffeb79f4f}{Now}} -\/ \mbox{\hyperlink{class_quaternion_filter_a62ca83c2a4d4b15262600b47332ba2bf}{lastUpdate}}) / 1000000.0f); \textcolor{comment}{// set integration time by time elapsed since last filter update}}
\DoxyCodeLine{66         \mbox{\hyperlink{class_quaternion_filter_a62ca83c2a4d4b15262600b47332ba2bf}{lastUpdate}} = \mbox{\hyperlink{class_quaternion_filter_a4aecefd720d2303c9415bdbffeb79f4f}{Now}};}
\DoxyCodeLine{67 }
\DoxyCodeLine{68         \textcolor{comment}{// Normalise accelerometer measurement}}
\DoxyCodeLine{69         norm = sqrtf(ax * ax + ay * ay + az * az);}
\DoxyCodeLine{70         \textcolor{keywordflow}{if} (norm == 0.0f) \textcolor{keywordflow}{return}; \textcolor{comment}{// handle NaN}}
\DoxyCodeLine{71         norm = 1.0f / norm;}
\DoxyCodeLine{72         ax *= norm;}
\DoxyCodeLine{73         ay *= norm;}
\DoxyCodeLine{74         az *= norm;}
\DoxyCodeLine{75 }
\DoxyCodeLine{76         \textcolor{comment}{// Normalise magnetometer measurement}}
\DoxyCodeLine{77         norm = sqrtf(mx * mx + my * my + mz * mz);}
\DoxyCodeLine{78         \textcolor{keywordflow}{if} (norm == 0.0f) \textcolor{keywordflow}{return}; \textcolor{comment}{// handle NaN}}
\DoxyCodeLine{79         norm = 1.0f / norm;}
\DoxyCodeLine{80         mx *= norm;}
\DoxyCodeLine{81         my *= norm;}
\DoxyCodeLine{82         mz *= norm;}
\DoxyCodeLine{83 }
\DoxyCodeLine{84         \textcolor{comment}{// Reference direction of Earth's magnetic field}}
\DoxyCodeLine{85         \_2q1mx = 2.0f * q1 * mx;}
\DoxyCodeLine{86         \_2q1my = 2.0f * q1 * my;}
\DoxyCodeLine{87         \_2q1mz = 2.0f * q1 * mz;}
\DoxyCodeLine{88         \_2q2mx = 2.0f * q2 * mx;}
\DoxyCodeLine{89         hx = mx * q1q1 -\/ \_2q1my * q4 + \_2q1mz * q3 + mx * q2q2 + \_2q2 * my * q3 + \_2q2 * mz * q4 -\/ mx * q3q3 -\/ mx * q4q4;}
\DoxyCodeLine{90         hy = \_2q1mx * q4 + my * q1q1 -\/ \_2q1mz * q2 + \_2q2mx * q3 -\/ my * q2q2 + my * q3q3 + \_2q3 * mz * q4 -\/ my * q4q4;}
\DoxyCodeLine{91         \_2bx = sqrtf(hx * hx + hy * hy);}
\DoxyCodeLine{92         \_2bz = -\/\_2q1mx * q3 + \_2q1my * q2 + mz * q1q1 + \_2q2mx * q4 -\/ mz * q2q2 + \_2q3 * my * q4 -\/ mz * q3q3 + mz * q4q4;}
\DoxyCodeLine{93         \_4bx = 2.0f * \_2bx;}
\DoxyCodeLine{94         \_4bz = 2.0f * \_2bz;}
\DoxyCodeLine{95 }
\DoxyCodeLine{96         \textcolor{comment}{// Gradient decent algorithm corrective step}}
\DoxyCodeLine{97         s1 = -\/\_2q3 * (2.0f * q2q4 -\/ \_2q1q3 -\/ ax) + \_2q2 * (2.0f * q1q2 + \_2q3q4 -\/ ay) -\/ \_2bz * q3 * (\_2bx * (0.5f -\/ q3q3 -\/ q4q4) + \_2bz * (q2q4 -\/ q1q3) -\/ mx) + (-\/\_2bx * q4 + \_2bz * q2) * (\_2bx * (q2q3 -\/ q1q4) + \_2bz * (q1q2 + q3q4) -\/ my) + \_2bx * q3 * (\_2bx * (q1q3 + q2q4) + \_2bz * (0.5f -\/ q2q2 -\/ q3q3) -\/ mz);}
\DoxyCodeLine{98         s2 = \_2q4 * (2.0f * q2q4 -\/ \_2q1q3 -\/ ax) + \_2q1 * (2.0f * q1q2 + \_2q3q4 -\/ ay) -\/ 4.0f * q2 * (1.0f -\/ 2.0f * q2q2 -\/ 2.0f * q3q3 -\/ az) + \_2bz * q4 * (\_2bx * (0.5f -\/ q3q3 -\/ q4q4) + \_2bz * (q2q4 -\/ q1q3) -\/ mx) + (\_2bx * q3 + \_2bz * q1) * (\_2bx * (q2q3 -\/ q1q4) + \_2bz * (q1q2 + q3q4) -\/ my) + (\_2bx * q4 -\/ \_4bz * q2) * (\_2bx * (q1q3 + q2q4) + \_2bz * (0.5f -\/ q2q2 -\/ q3q3) -\/ mz);}
\DoxyCodeLine{99         s3 = -\/\_2q1 * (2.0f * q2q4 -\/ \_2q1q3 -\/ ax) + \_2q4 * (2.0f * q1q2 + \_2q3q4 -\/ ay) -\/ 4.0f * q3 * (1.0f -\/ 2.0f * q2q2 -\/ 2.0f * q3q3 -\/ az) + (-\/\_4bx * q3 -\/ \_2bz * q1) * (\_2bx * (0.5f -\/ q3q3 -\/ q4q4) + \_2bz * (q2q4 -\/ q1q3) -\/ mx) + (\_2bx * q2 + \_2bz * q4) * (\_2bx * (q2q3 -\/ q1q4) + \_2bz * (q1q2 + q3q4) -\/ my) + (\_2bx * q1 -\/ \_4bz * q3) * (\_2bx * (q1q3 + q2q4) + \_2bz * (0.5f -\/ q2q2 -\/ q3q3) -\/ mz);}
\DoxyCodeLine{100         s4 = \_2q2 * (2.0f * q2q4 -\/ \_2q1q3 -\/ ax) + \_2q3 * (2.0f * q1q2 + \_2q3q4 -\/ ay) + (-\/\_4bx * q4 + \_2bz * q2) * (\_2bx * (0.5f -\/ q3q3 -\/ q4q4) + \_2bz * (q2q4 -\/ q1q3) -\/ mx) + (-\/\_2bx * q1 + \_2bz * q3) * (\_2bx * (q2q3 -\/ q1q4) + \_2bz * (q1q2 + q3q4) -\/ my) + \_2bx * q2 * (\_2bx * (q1q3 + q2q4) + \_2bz * (0.5f -\/ q2q2 -\/ q3q3) -\/ mz);}
\DoxyCodeLine{101         norm = sqrtf(s1 * s1 + s2 * s2 + s3 * s3 + s4 * s4);    \textcolor{comment}{// normalise step magnitude}}
\DoxyCodeLine{102         norm = 1.0f/norm;}
\DoxyCodeLine{103         s1 *= norm;}
\DoxyCodeLine{104         s2 *= norm;}
\DoxyCodeLine{105         s3 *= norm;}
\DoxyCodeLine{106         s4 *= norm;}
\DoxyCodeLine{107 }
\DoxyCodeLine{108         \textcolor{comment}{// Compute rate of change of quaternion}}
\DoxyCodeLine{109         qDot1 = 0.5f * (-\/q2 * gx -\/ q3 * gy -\/ q4 * gz) -\/ \mbox{\hyperlink{class_quaternion_filter_abd5ceeec025272a84597125052265710}{beta}} * s1;}
\DoxyCodeLine{110         qDot2 = 0.5f * (q1 * gx + q3 * gz -\/ q4 * gy) -\/ \mbox{\hyperlink{class_quaternion_filter_abd5ceeec025272a84597125052265710}{beta}} * s2;}
\DoxyCodeLine{111         qDot3 = 0.5f * (q1 * gy -\/ q2 * gz + q4 * gx) -\/ \mbox{\hyperlink{class_quaternion_filter_abd5ceeec025272a84597125052265710}{beta}} * s3;}
\DoxyCodeLine{112         qDot4 = 0.5f * (q1 * gz + q2 * gy -\/ q3 * gx) -\/ \mbox{\hyperlink{class_quaternion_filter_abd5ceeec025272a84597125052265710}{beta}} * s4;}
\DoxyCodeLine{113 }
\DoxyCodeLine{114         \textcolor{comment}{// Integrate to yield quaternion}}
\DoxyCodeLine{115         q1 += qDot1 * \mbox{\hyperlink{class_quaternion_filter_a0d455d04c45199160db280a5adf45a9a}{deltat}};}
\DoxyCodeLine{116         q2 += qDot2 * \mbox{\hyperlink{class_quaternion_filter_a0d455d04c45199160db280a5adf45a9a}{deltat}};}
\DoxyCodeLine{117         q3 += qDot3 * \mbox{\hyperlink{class_quaternion_filter_a0d455d04c45199160db280a5adf45a9a}{deltat}};}
\DoxyCodeLine{118         q4 += qDot4 * \mbox{\hyperlink{class_quaternion_filter_a0d455d04c45199160db280a5adf45a9a}{deltat}};}
\DoxyCodeLine{119         norm = sqrtf(q1 * q1 + q2 * q2 + q3 * q3 + q4 * q4);    \textcolor{comment}{// normalise quaternion}}
\DoxyCodeLine{120         norm = 1.0f/norm;}
\DoxyCodeLine{121         q[0] = q1 * norm;}
\DoxyCodeLine{122         q[1] = q2 * norm;}
\DoxyCodeLine{123         q[2] = q3 * norm;}
\DoxyCodeLine{124         q[3] = q4 * norm;}
\DoxyCodeLine{125     \}}

\end{DoxyCode}


\doxysubsection{Member Data Documentation}
\mbox{\Hypertarget{class_quaternion_filter_abd5ceeec025272a84597125052265710}\label{class_quaternion_filter_abd5ceeec025272a84597125052265710}} 
\index{QuaternionFilter@{QuaternionFilter}!beta@{beta}}
\index{beta@{beta}!QuaternionFilter@{QuaternionFilter}}
\doxysubsubsection{\texorpdfstring{beta}{beta}}
{\footnotesize\ttfamily float Quaternion\+Filter\+::beta = sqrt(3.\+0f / 4.\+0f) $\ast$ \mbox{\hyperlink{class_quaternion_filter_a3a8ca78e23c86ceeae34482bdb13aa7d}{Gyro\+Meas\+Error}}\hspace{0.3cm}{\ttfamily [private]}}



Definition at line 10 of file Quaternion\+Filter.\+h.

\mbox{\Hypertarget{class_quaternion_filter_a0d455d04c45199160db280a5adf45a9a}\label{class_quaternion_filter_a0d455d04c45199160db280a5adf45a9a}} 
\index{QuaternionFilter@{QuaternionFilter}!deltat@{deltat}}
\index{deltat@{deltat}!QuaternionFilter@{QuaternionFilter}}
\doxysubsubsection{\texorpdfstring{deltat}{deltat}}
{\footnotesize\ttfamily float Quaternion\+Filter\+::deltat = 0.\+0f\hspace{0.3cm}{\ttfamily [private]}}



Definition at line 15 of file Quaternion\+Filter.\+h.

\mbox{\Hypertarget{class_quaternion_filter_afa8fc4d4be86803a96d7c0dc54b9e0cf}\label{class_quaternion_filter_afa8fc4d4be86803a96d7c0dc54b9e0cf}} 
\index{QuaternionFilter@{QuaternionFilter}!eInt@{eInt}}
\index{eInt@{eInt}!QuaternionFilter@{QuaternionFilter}}
\doxysubsubsection{\texorpdfstring{eInt}{eInt}}
{\footnotesize\ttfamily float Quaternion\+Filter\+::e\+Int\mbox{[}3\mbox{]} = \{0.\+0f, 0.\+0f, 0.\+0f\}\hspace{0.3cm}{\ttfamily [private]}}



Definition at line 20 of file Quaternion\+Filter.\+h.

\mbox{\Hypertarget{class_quaternion_filter_a5b637ebad8bb92ef780af205ae77283c}\label{class_quaternion_filter_a5b637ebad8bb92ef780af205ae77283c}} 
\index{QuaternionFilter@{QuaternionFilter}!firstUpdate@{firstUpdate}}
\index{firstUpdate@{firstUpdate}!QuaternionFilter@{QuaternionFilter}}
\doxysubsubsection{\texorpdfstring{firstUpdate}{firstUpdate}}
{\footnotesize\ttfamily uint32\+\_\+t Quaternion\+Filter\+::first\+Update = 0\hspace{0.3cm}{\ttfamily [private]}}



Definition at line 16 of file Quaternion\+Filter.\+h.

\mbox{\Hypertarget{class_quaternion_filter_ab30d4bce3891d2c5fc338b3252560c0f}\label{class_quaternion_filter_ab30d4bce3891d2c5fc338b3252560c0f}} 
\index{QuaternionFilter@{QuaternionFilter}!GyroMeasDrift@{GyroMeasDrift}}
\index{GyroMeasDrift@{GyroMeasDrift}!QuaternionFilter@{QuaternionFilter}}
\doxysubsubsection{\texorpdfstring{GyroMeasDrift}{GyroMeasDrift}}
{\footnotesize\ttfamily float Quaternion\+Filter\+::\+Gyro\+Meas\+Drift = PI $\ast$ (0.\+0f / 180.\+0f)\hspace{0.3cm}{\ttfamily [private]}}



Definition at line 9 of file Quaternion\+Filter.\+h.

\mbox{\Hypertarget{class_quaternion_filter_a3a8ca78e23c86ceeae34482bdb13aa7d}\label{class_quaternion_filter_a3a8ca78e23c86ceeae34482bdb13aa7d}} 
\index{QuaternionFilter@{QuaternionFilter}!GyroMeasError@{GyroMeasError}}
\index{GyroMeasError@{GyroMeasError}!QuaternionFilter@{QuaternionFilter}}
\doxysubsubsection{\texorpdfstring{GyroMeasError}{GyroMeasError}}
{\footnotesize\ttfamily float Quaternion\+Filter\+::\+Gyro\+Meas\+Error = PI $\ast$ (40.\+0f / 180.\+0f)\hspace{0.3cm}{\ttfamily [private]}}



Definition at line 8 of file Quaternion\+Filter.\+h.

\mbox{\Hypertarget{class_quaternion_filter_a7d15579f2818aa39a3b98e84ac4eaf3e}\label{class_quaternion_filter_a7d15579f2818aa39a3b98e84ac4eaf3e}} 
\index{QuaternionFilter@{QuaternionFilter}!Ki@{Ki}}
\index{Ki@{Ki}!QuaternionFilter@{QuaternionFilter}}
\doxysubsubsection{\texorpdfstring{Ki}{Ki}}
{\footnotesize\ttfamily const float Quaternion\+Filter\+::\+Ki = 0.\+0f\hspace{0.3cm}{\ttfamily [private]}}



Definition at line 13 of file Quaternion\+Filter.\+h.

\mbox{\Hypertarget{class_quaternion_filter_afe6f117c82a21e9ddde4c9c9b9dbbc15}\label{class_quaternion_filter_afe6f117c82a21e9ddde4c9c9b9dbbc15}} 
\index{QuaternionFilter@{QuaternionFilter}!Kp@{Kp}}
\index{Kp@{Kp}!QuaternionFilter@{QuaternionFilter}}
\doxysubsubsection{\texorpdfstring{Kp}{Kp}}
{\footnotesize\ttfamily const float Quaternion\+Filter\+::\+Kp = 2.\+0f $\ast$ 5.\+0f\hspace{0.3cm}{\ttfamily [private]}}



Definition at line 12 of file Quaternion\+Filter.\+h.

\mbox{\Hypertarget{class_quaternion_filter_a62ca83c2a4d4b15262600b47332ba2bf}\label{class_quaternion_filter_a62ca83c2a4d4b15262600b47332ba2bf}} 
\index{QuaternionFilter@{QuaternionFilter}!lastUpdate@{lastUpdate}}
\index{lastUpdate@{lastUpdate}!QuaternionFilter@{QuaternionFilter}}
\doxysubsubsection{\texorpdfstring{lastUpdate}{lastUpdate}}
{\footnotesize\ttfamily uint32\+\_\+t Quaternion\+Filter\+::last\+Update = 0\hspace{0.3cm}{\ttfamily [private]}}



Definition at line 16 of file Quaternion\+Filter.\+h.

\mbox{\Hypertarget{class_quaternion_filter_a4aecefd720d2303c9415bdbffeb79f4f}\label{class_quaternion_filter_a4aecefd720d2303c9415bdbffeb79f4f}} 
\index{QuaternionFilter@{QuaternionFilter}!Now@{Now}}
\index{Now@{Now}!QuaternionFilter@{QuaternionFilter}}
\doxysubsubsection{\texorpdfstring{Now}{Now}}
{\footnotesize\ttfamily uint32\+\_\+t Quaternion\+Filter\+::\+Now = 0\hspace{0.3cm}{\ttfamily [private]}}



Definition at line 17 of file Quaternion\+Filter.\+h.

\mbox{\Hypertarget{class_quaternion_filter_a0e194aa9d6527928626fab538aecc20e}\label{class_quaternion_filter_a0e194aa9d6527928626fab538aecc20e}} 
\index{QuaternionFilter@{QuaternionFilter}!sum@{sum}}
\index{sum@{sum}!QuaternionFilter@{QuaternionFilter}}
\doxysubsubsection{\texorpdfstring{sum}{sum}}
{\footnotesize\ttfamily float Quaternion\+Filter\+::sum = 0.\+0f\hspace{0.3cm}{\ttfamily [private]}}



Definition at line 15 of file Quaternion\+Filter.\+h.

\mbox{\Hypertarget{class_quaternion_filter_a61c16cff27a1b1dad8b5ed185f040a8a}\label{class_quaternion_filter_a61c16cff27a1b1dad8b5ed185f040a8a}} 
\index{QuaternionFilter@{QuaternionFilter}!zeta@{zeta}}
\index{zeta@{zeta}!QuaternionFilter@{QuaternionFilter}}
\doxysubsubsection{\texorpdfstring{zeta}{zeta}}
{\footnotesize\ttfamily float Quaternion\+Filter\+::zeta = sqrt(3.\+0f / 4.\+0f) $\ast$ \mbox{\hyperlink{class_quaternion_filter_ab30d4bce3891d2c5fc338b3252560c0f}{Gyro\+Meas\+Drift}}\hspace{0.3cm}{\ttfamily [private]}}



Definition at line 11 of file Quaternion\+Filter.\+h.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{_quaternion_filter_8h}{Quaternion\+Filter.\+h}}\end{DoxyCompactItemize}
